<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test AI Features</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #667eea; }
        h2 { color: #764ba2; margin-top: 0; }
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        input {
            padding: 10px;
            width: 300px;
            margin-right: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
        }
        .result {
            background: #f9f9f9;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .product-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        .error { color: #ef4444; font-weight: 600; }
        .success { color: #10b981; font-weight: 600; }
        pre {
            background: #1a1a1a;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ü§ñ Test AI Features & Email Notifications</h1>

    <!-- Login Section -->
    <div class="section">
        <h2>1Ô∏è‚É£ Login First</h2>
        <p>You need to be logged in to test AI features</p>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
        <div id="loginResult" class="result" style="display:none"></div>
    </div>

    <!-- AI Recommendations -->
    <div class="section">
        <h2>2Ô∏è‚É£ AI Product Recommendations</h2>
        <p>Get personalized product recommendations based on your history</p>
        <button onclick="getRecommendations()">Get AI Recommendations</button>
        <div id="recommendationsResult" class="result" style="display:none"></div>
        <div id="recommendationsGrid" class="product-grid"></div>
    </div>

    <!-- AI Description Generator -->
    <div class="section">
        <h2>3Ô∏è‚É£ AI Product Description Generator</h2>
        <p>Generate AI-powered product descriptions</p>
        <input type="text" id="productName" placeholder="Product Name" value="Smart Watch Pro">
        <input type="text" id="category" placeholder="Category" value="Electronics">
        <button onclick="generateDescription()">Generate Description</button>
        <div id="descriptionResult" class="result" style="display:none"></div>
    </div>

    <!-- Email Test -->
    <div class="section">
        <h2>4Ô∏è‚É£ Email Notification Test</h2>
        <p><strong>Note:</strong> Email requires Gmail configuration in backend/.env</p>
        <p>To enable emails, update these in <code>backend/.env</code>:</p>
        <pre>EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password</pre>
        <p>Then place an order to trigger email notification automatically!</p>
        <button onclick="testOrder()">Test Order (Triggers Email)</button>
        <div id="orderResult" class="result" style="display:none"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let token = localStorage.getItem('token');

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await response.json();
                
                if (data.success) {
                    token = data.data.token;
                    localStorage.setItem('token', token);
                    showResult('loginResult', `‚úÖ Login successful! Token: ${token.substring(0, 20)}...`, 'success');
                } else {
                    showResult('loginResult', `‚ùå ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('loginResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function getRecommendations() {
            if (!token) {
                showResult('recommendationsResult', '‚ùå Please login first!', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/ai/recommendations?limit=6`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('recommendationsResult', `‚úÖ Found ${data.count} AI recommendations!`, 'success');
                    displayRecommendations(data.data);
                } else {
                    showResult('recommendationsResult', `‚ùå ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('recommendationsResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        function displayRecommendations(products) {
            const grid = document.getElementById('recommendationsGrid');
            grid.innerHTML = products.map(p => `
                <div class="product-card">
                    <h3 style="color:#667eea;margin:0 0 10px 0">${p.name}</h3>
                    <p style="color:#666;font-size:14px;margin:5px 0">
                        <strong>Category:</strong> ${p.category}
                    </p>
                    <p style="color:#764ba2;font-size:20px;font-weight:700;margin:10px 0">
                        $${p.price.toFixed(2)}
                    </p>
                    ${p.reason ? `<p style="color:#10b981;font-size:12px;font-style:italic">üìä ${p.reason}</p>` : ''}
                </div>
            `).join('');
        }

        async function generateDescription() {
            if (!token) {
                showResult('descriptionResult', '‚ùå Please login first!', 'error');
                return;
            }

            const name = document.getElementById('productName').value;
            const category = document.getElementById('category').value;

            try {
                const response = await fetch(`${API_URL}/ai/generate-description`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, category })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('descriptionResult', 
                        `‚úÖ AI Generated Description:<br><br><em style="color:#333">"${data.data.description}"</em>`, 
                        'success'
                    );
                } else {
                    showResult('descriptionResult', `‚ùå ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('descriptionResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testOrder() {
            if (!token) {
                showResult('orderResult', '‚ùå Please login first!', 'error');
                return;
            }

            // First add items to cart
            try {
                // Add a product to cart
                await fetch(`${API_URL}/cart`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ productId: 'some-product-id', quantity: 1 })
                });

                // Create order
                const response = await fetch(`${API_URL}/orders`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        shippingAddress: '123 Test St, City, Country',
                        paymentMethod: 'Credit Card'
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    showResult('orderResult', 
                        `‚úÖ Order placed! Order ID: ${data.data.orderId}<br><br>
                        üíå If EMAIL_USER and EMAIL_PASSWORD are configured in .env, you should receive an email!<br><br>
                        Check backend console for email status.`, 
                        'success'
                    );
                } else {
                    showResult('orderResult', `‚ùå ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('orderResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        function showResult(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.innerHTML = message;
            el.style.display = 'block';
            el.className = `result ${type}`;
        }

        // Check if already logged in
        if (token) {
            showResult('loginResult', '‚úÖ Already logged in!', 'success');
        }
    </script>
</body>
</html>
